<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sample Rate vs Aggregation Uncertainty</title>
    <link rel="stylesheet" href="styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <div class="container">
      <h1>Sample Rate vs Aggregation Uncertainty</h1>

      <div class="intro-section">
        <div class="purpose-card">
          <div class="card-icon">üéØ</div>
          <div class="card-content">
            <h3>Purpose</h3>
            <p>
              Your application generates massive amounts of telemetry data. While you want to reduce storage costs by dropping redundant data, you still need
              accurate live aggregations. <strong>Sampling</strong> is the solution‚Äîbut how much can you sample before your metrics become unreliable?
            </p>
            <p>
              This interactive tool helps you understand the trade-offs between sample rates and aggregation accuracy for different data volumes and
              distributions.
            </p>
          </div>
        </div>

        <div class="demo-card">
          <div class="card-icon">üî¨</div>
          <div class="card-content">
            <h3>Interactive Demo</h3>
            <p>
              Adjust the volume, sample rate, and distribution parameters below to see real-time simulations of how sampling affects aggregation accuracy.
              Confidence intervals are calculated from multiple sampling runs.
            </p>
          </div>
        </div>

        <div class="disclaimer-card">
          <div class="card-icon">‚ö†Ô∏è</div>
          <div class="card-content">
            <h3>Disclaimer</h3>
            <p>
              This tool was developed with AI assistance. While the simulations and aggregations appear correct, the confidence interval calculations should be
              independently verified before use in production decisions.
            </p>
          </div>
        </div>
      </div>

      <div class="controls">
        <div class="control-group">
          <label for="volume">Volume of Events (before sampling)</label>
          <div class="slider-container">
            <input type="range" id="volume" min="2" max="7" value="4" step="0.1" />
            <span class="value-display" id="volumeValue">10,000</span>
          </div>
        </div>

        <div class="control-group">
          <label for="sampleRate">Sample Rate (keep 1 out of N events)</label>
          <div class="slider-container">
            <input type="range" id="sampleRate" min="1" max="1000" value="10" step="1" />
            <span class="value-display" id="sampleRateValue">1:10</span>
          </div>
        </div>

        <div class="control-group">
          <label for="distribution">Distribution Type</label>
          <select id="distribution">
            <option value="normal" selected>Normal (Œº=100, œÉ=20)</option>
            <option value="exponential">Exponential (Œª=1)</option>
            <option value="uniform">Uniform (0-200)</option>
            <option value="lognormal">Log-Normal (Œº=4, œÉ=1)</option>
            <option value="bimodal">Bimodal</option>
          </select>
        </div>
      </div>

      <div class="distribution-chart">
        <h3>Theoretical Distribution</h3>
        <div class="chart-container">
          <canvas id="distributionChart"></canvas>
        </div>
      </div>

      <div class="explanation">
        <p>{number of events} events go in</p>
        <p>to {number of simulations} simulations</p>
        <p>Sampled at a rate of 1:{sample rate}</p>
        <p>Saving you {percentage reduction}</p>
        <p>About {number of events / sample rate} events come out</p>
        <p>Then we aggregate the sampled events.</p>
        <p>The following charts compare the results of aggregating sampled events (knowing the sample rate) vs aggregating the full set of events.</p>
      </div>

      <div class="p99-scatter-chart">
        <div class="chart-header">
          <h3>P99 For Each Simulation, Before and After Sampling</h3>
          <div class="chart-controls">
            <label for="p99YAxisToggle">Y-axis:</label>
            <select id="p99YAxisToggle">
              <option value="zoomed">Zoomed (auto-scale)</option>
              <option value="full" selected>Full scale (from 0)</option>
            </select>
          </div>
        </div>
        <div class="chart-container">
          <canvas id="p99ScatterChart"></canvas>
        </div>
      </div>

      <div class="count-scatter-chart">
        <div class="chart-header">
          <h3>COUNT For Each Simulation, Before and After Sampling</h3>
          <div class="chart-controls">
            <label for="countYAxisToggle">Y-axis:</label>
            <select id="countYAxisToggle">
              <option value="zoomed">Zoomed (auto-scale)</option>
              <option value="full" selected>Full scale (from 0)</option>
            </select>
          </div>
        </div>
        <div class="chart-container">
          <canvas id="countScatterChart"></canvas>
        </div>
      </div>

      <div class="sum-scatter-chart">
        <div class="chart-header">
          <h3>SUM For Each Simulation, Before and After Sampling</h3>
          <div class="chart-controls">
            <label for="sumYAxisToggle">Y-axis:</label>
            <select id="sumYAxisToggle">
              <option value="zoomed">Zoomed (auto-scale)</option>
              <option value="full" selected>Full scale (from 0)</option>
            </select>
          </div>
        </div>
        <div class="chart-container">
          <canvas id="sumScatterChart"></canvas>
        </div>
      </div>

      <div class="average-scatter-chart">
        <div class="chart-header">
          <h3>AVERAGE For Each Simulation, Before and After Sampling</h3>
          <div class="chart-controls">
            <label for="averageYAxisToggle">Y-axis:</label>
            <select id="averageYAxisToggle">
              <option value="zoomed">Zoomed (auto-scale)</option>
              <option value="full" selected>Full scale (from 0)</option>
            </select>
          </div>
        </div>
        <div class="chart-container">
          <canvas id="averageScatterChart"></canvas>
        </div>
      </div>

      <div class="runs-display" id="runsDisplay">Running simulations...</div>
    </div>

    <footer>
      <a href="https://github.com/jessitron/sampling-error-tradeoffs">View on GitHub</a>
    </footer>

    <script src="index.js"></script>
  </body>
</html>
