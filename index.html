<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sample Rate vs Aggregation Uncertainty</title>
    <link rel="stylesheet" href="styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <div class="container">
      <h1>Sample Rate vs Aggregation Uncertainty</h1>

      <div class="info-panel">
        <strong>Demo:</strong> Adjust the volume, sample rate, and distribution to see how sampling affects aggregation accuracy. Confidence intervals are
        calculated from multiple sampling runs in real-time.
      </div>

      <div class="controls">
        <div class="control-group">
          <label for="volume">Volume of Events (before sampling)</label>
          <div class="slider-container">
            <input type="range" id="volume" min="2" max="7" value="4" step="0.1" />
            <span class="value-display" id="volumeValue">10,000</span>
          </div>
        </div>

        <div class="control-group">
          <label for="sampleRate">Sample Rate (keep 1 out of N events)</label>
          <div class="slider-container">
            <input type="range" id="sampleRate" min="1" max="1000" value="10" step="1" />
            <span class="value-display" id="sampleRateValue">1:10</span>
          </div>
        </div>

        <div class="control-group">
          <label for="distribution">Distribution Type</label>
          <select id="distribution">
            <option value="normal" selected>Normal (μ=100, σ=20)</option>
            <option value="exponential">Exponential (λ=1)</option>
            <option value="uniform">Uniform (0-200)</option>
            <option value="lognormal">Log-Normal (μ=4, σ=1)</option>
            <option value="bimodal">Bimodal</option>
          </select>
        </div>
      </div>

      <div class="distribution-chart">
        <h3>Theoretical Distribution</h3>
        <div class="chart-container">
          <canvas id="distributionChart"></canvas>
        </div>
      </div>

      <div class="p99-scatter-chart">
        <div class="chart-header">
          <h3>P99 For Each Simulation, Before and After Sampling</h3>
          <div class="chart-controls">
            <label for="p99YAxisToggle">Y-axis:</label>
            <select id="p99YAxisToggle">
              <option value="zoomed" selected>Zoomed (auto-scale)</option>
              <option value="full">Full scale (from 0)</option>
            </select>
          </div>
        </div>
        <div class="chart-container">
          <canvas id="p99ScatterChart"></canvas>
        </div>
      </div>

      <div class="stats-summary">
        <div class="stat-item">
          <div class="stat-label">Total Events</div>
          <div class="stat-value" id="totalEvents">10,000</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Sampled Events</div>
          <div class="stat-value" id="sampledEvents">1,000</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Sampling Ratio</div>
          <div class="stat-value" id="samplingRatio">10.0%</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Theoretical Error</div>
          <div class="stat-value" id="theoreticalError">±3.16%</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Simulation Runs</div>
          <div class="stat-value" id="simulationRuns">50</div>
        </div>
      </div>

      <div class="metrics">
        <div class="metric-card">
          <div class="metric-title">COUNT</div>
          <div class="metric-values">
            <span>True: <span class="true-value" id="trueCount">0</span></span>
            <span>Sampled: <span class="sampled-value" id="sampledCount">0</span></span>
          </div>
          <div class="confidence-interval" id="countCI">95% CI: [0, 0]</div>
          <div class="error-display">Error: <span id="countError">0.0%</span></div>
        </div>

        <div class="metric-card">
          <div class="metric-title">SUM</div>
          <div class="metric-values">
            <span>True: <span class="true-value" id="trueSum">0</span></span>
            <span>Sampled: <span class="sampled-value" id="sampledSum">0</span></span>
          </div>
          <div class="confidence-interval" id="sumCI">95% CI: [0, 0]</div>
          <div class="error-display">Error: <span id="sumError">0.0%</span></div>
        </div>

        <div class="metric-card">
          <div class="metric-title">AVERAGE</div>
          <div class="metric-values">
            <span>True: <span class="true-value" id="trueAvg">0</span></span>
            <span>Sampled: <span class="sampled-value" id="sampledAvg">0</span></span>
          </div>
          <div class="confidence-interval" id="avgCI">95% CI: [0, 0]</div>
          <div class="error-display">Error: <span id="avgError">0.0%</span></div>
        </div>

        <div class="metric-card">
          <div class="metric-title">P99</div>
          <div class="metric-values">
            <span>True: <span class="true-value" id="trueP99">0</span></span>
            <span>Sampled: <span class="sampled-value" id="sampledP99">0</span></span>
          </div>
          <div class="confidence-interval" id="p99CI">95% CI: [0, 0]</div>
          <div class="error-display">Error: <span id="p99Error">0.0%</span></div>
        </div>
      </div>

      <div class="runs-display" id="runsDisplay">Running simulations...</div>
    </div>

    <script src="index.js"></script>
  </body>
</html>
